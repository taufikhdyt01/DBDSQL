CREATE DATABASE KLINIK;
USE KLINIK;

CREATE TABLE RUANGAN (
	ID_RUANGAN SMALLINT NOT NULL PRIMARY KEY,
    NAMA VARCHAR(35),
    NO_RUANGAN VARCHAR(5) UNIQUE
);

CREATE TABLE MANUSIA (
	KTP VARCHAR(16) NOT NULL UNIQUE,
    NAMA VARCHAR(50) NOT NULL,
    JENIS_KELAMIN CHAR(1) CHECK (JENIS_KELAMIN IN ("L", "P")),
    TANGGAL_LAHIR DATE,
    ALAMAT VARCHAR(100)
);

CREATE TABLE PEKERJA (
	ID_PEKERJA SMALLINT NOT NULL PRIMARY KEY,
    NIP VARCHAR(16) UNIQUE,
    KTP VARCHAR(16) NOT NULL UNIQUE,
    FOREIGN KEY (KTP) REFERENCES MANUSIA (KTP)
);

CREATE TABLE DOKTER (
	ID_PEKERJA SMALLINT NOT NULL PRIMARY KEY,
    SPESIALIS VARCHAR(20),
    JAM_PRAKTIK VARCHAR(20),
    FOREIGN KEY (ID_PEKERJA) REFERENCES PEKERJA (ID_PEKERJA)
);

CREATE TABLE PERAWAT (
	ID_PEKERJA SMALLINT NOT NULL PRIMARY KEY,
    JAM_JAGA VARCHAR(20),
    FOREIGN KEY (ID_PEKERJA) REFERENCES PEKERJA (ID_PEKERJA)
);

CREATE TABLE STAFF_ADMINISTRASI (
	ID_PEKERJA SMALLINT NOT NULL PRIMARY KEY,
    STR VARCHAR(20),
    FOREIGN KEY (ID_PEKERJA) REFERENCES PEKERJA (ID_PEKERJA)
);

CREATE TABLE SATPAM (
	ID_PEKERJA SMALLINT NOT NULL PRIMARY KEY,
    ID_RUANGAN SMALLINT,
    KOMPETENSI_SECURITY VARCHAR(20),
	FOREIGN KEY (ID_PEKERJA) REFERENCES PEKERJA (ID_PEKERJA),
    FOREIGN KEY (ID_RUANGAN) REFERENCES RUANGAN (ID_RUANGAN)
    
);

CREATE TABLE OB (
	ID_PEKERJA SMALLINT NOT NULL PRIMARY KEY,
    ID_RUANGAN SMALLINT,
    POSISI VARCHAR(20),
	FOREIGN KEY (ID_PEKERJA) REFERENCES PEKERJA (ID_PEKERJA),
    FOREIGN KEY (ID_RUANGAN) REFERENCES RUANGAN (ID_RUANGAN)
);

CREATE TABLE KASIR (
	ID_PEKERJA SMALLINT NOT NULL PRIMARY KEY,
    SKILL_FINANCIAL VARCHAR(20),
	FOREIGN KEY (ID_PEKERJA) REFERENCES PEKERJA (ID_PEKERJA)
);

CREATE TABLE APOTEKER (
	ID_PEKERJA SMALLINT NOT NULL PRIMARY KEY,
    SKPA VARCHAR(40),
	FOREIGN KEY (ID_PEKERJA) REFERENCES PEKERJA (ID_PEKERJA)
);

CREATE TABLE POLI (
	ID_POLI SMALLINT NOT NULL PRIMARY KEY,
	NAMA VARCHAR(35)
);

CREATE TABLE OBAT (
	ID_OBAT INT NOT NULL PRIMARY KEY,
    NAMA VARCHAR(35),
    MASA_BERLAKU DATE 
);

CREATE TABLE PASIEN (
	ID_PASIEN INT NOT NULL PRIMARY KEY,
    BPJS VARCHAR(13) UNIQUE,
    KTP VARCHAR(16) NOT NULL UNIQUE,
    ID_PEKERJA_DOKTER SMALLINT,
    ID_PEKERJA_PERAWAT SMALLINT,
    ID_PEKERJA_ADMINISTRASI SMALLINT,
    ID_PEKERJA_KASIR SMALLINT,
    ID_POLI SMALLINT,
    ID_OBAT INT,
    FOREIGN KEY (KTP) REFERENCES MANUSIA (KTP),
    FOREIGN KEY (ID_PEKERJA_DOKTER) REFERENCES DOKTER (ID_PEKERJA),
    FOREIGN KEY (ID_PEKERJA_PERAWAT) REFERENCES PERAWAT (ID_PEKERJA),
    FOREIGN KEY (ID_PEKERJA_ADMINISTRASI) REFERENCES STAFF_ADMINISTRASI (ID_PEKERJA),
    FOREIGN KEY (ID_PEKERJA_KASIR) REFERENCES KASIR (ID_PEKERJA),
    FOREIGN KEY (ID_POLI) REFERENCES POLI (ID_POLI),
    FOREIGN KEY (ID_OBAT) REFERENCES OBAT (ID_OBAT)
);

INSERT INTO MANUSIA 
VALUES 	('3504015604020003', 'dr. Gabriella Fadhilatus Awanda', 'P', '2002-04-16', 'Tulungagung'), /* Dr Umum*/
		('3206220106020003', 'dr. Taufik Hidayat', 'L', '2002-06-01', 'Tasikmalaya'), /* Dr Umum*/
		('3574011506030001', 'dr. Nimah Maghfiroh', 'P', '2003-06-15', 'Pati'),  /* Dr Umum*/
        ('3574011412020015', 'dr. Lintang Eka Aiastuti', 'P', '2002-12-14', 'Madiun'), /* Dr Umum*/
		('3512672506950005', 'dr. Gavino Barca Diyu Nugroho', 'L', '1995-06-25', 'Jember'), /* Dr Gigi*/
        ('3574011401030001', 'dr. Qornan Briliant Permana', 'L', '2003-01-14', 'Probolinggo'), /* Dr Gigi*/ 
        ('3574011910030001', 'dr. Muhammad Hilmi Adzkia', 'L', '2003-10-19', 'Jakarta'), /* Dr Gigi*/
        ('3574011909020005', 'Fikriya Rachma Dewi', 'P', '2002-09-19', 'Tuban'), /* Perawat */  
        ('3574011402000004', 'Iqbal Hasbunallah', 'P', '2000-02-14', 'Padang'),  /* Perawat */ 
        ('3574012303020005', 'Ajeng Kusuma Wardana', 'L', '2002-03-23', 'Makasar'), /* Perawat */ 
        ('3574012103020004', 'Biru Baguskara', 'L', '2002-03-21', 'Malang'), /* Perawat */ 
        ('3574011602010006', 'Ahmad Mardianto', 'L', '2001-02-16', 'Pati'), /* Satpam */
        ('3585200304020003', 'Angga Indrafata', 'L', '2002-04-03', 'Palangkaraya'),   /* Satpam */
        ('3585010102010003', 'Abimanya Trisatya', 'L', '2001-02-01', 'Malang'),   /* Administrasi */
        ('3585210405020003', 'Ratu Pricilia', 'P', '2002-05-04', 'Bogor'),   /* Administrasi */
        ('3585220305030003', 'Rina Pricilia', 'P', '2003-05-03', 'Madiun'),   /* Administrasi */
        ('3585230404030003', 'Givan Barca', 'L', '2003-04-04', 'Jember'),   /* Apoteker */
        ('3585240405020003', 'Gani Maulana', 'L', '2002-05-04', 'Madiun'),   /* Apoteker */
        ('3585250202030003', 'Doni Salman', 'L', '2003-02-02', 'Malang'),   /* OB */
        ('3585251203030003', 'Dida Maulana', 'L', '2003-03-12', 'Malang'),   /* OB */
        ('3585260104030003', 'Dinda Sari', 'P', '2003-04-01', 'Ciamis'),   /* Kasir */
        ('3585261402030003', 'Dandi Hendar', 'L', '2003-02-14', 'Tasikmalaya'),   /* Pasien */
        ('3586271203030003', 'Maulana Hendar', 'L', '2003-03-12', 'Tasikmalaya'),   /* Pasien */
        ('3589271606020003', 'Gebi Magfiroh', 'P', '2002-06-16', 'Tasikmalaya'),   /* Pasien */
        ('3589281301020003', 'Eka Rachma Dewi', 'P', '2002-01-13', 'Tasikmalaya'),   /* Pasien */
        ('3589291502020003', 'Dewi Rachma', 'P', '2002-02-15', 'Tasikmalaya'),   /* Pasien */
        ('3589381502020003', 'Andhini Dewi', 'P', '2002-02-15', 'Tasikmalaya'),   /* Pasien */
        ('3592381409020003', 'Sari Kusuma', 'P', '2002-09-14', 'Tasikmalaya'),   /* Pasien */
        ('3592382010020003', 'Yana Kusuma', 'L', '2002-10-20', 'Tasikmalaya'),   /* Pasien */
		('3592481210020003', 'Deni Kusuma', 'L', '2002-10-12', 'Tasikmalaya'),   /* Pasien */
		('3592621511020003', 'Jaya Wardana', 'L', '2002-11-15', 'Tasikmalaya');   /* Pasien */
        
INSERT INTO PEKERJA
VALUES	(1, '0002123045001', '3504015604020003'),/* Dr Umum*/
		(2, '0002123045002', '3206220106020003'),/* Dr Umum*/
        (3, '0002123045003', '3574011506030001'),/* Dr Umum*/
        (4, '0002123045004', '3574011412020015'),/* Dr Umum*/
        (5, '0002123045005', '3512672506950005'),/* Dr Gigi*/
        (6, '0002123045006', '3574011401030001'),/* Dr Gigi*/
        (7, '0002123045007', '3574011910030001'),/* Dr Gigi*/
        (8, '0002123045008', '3574011909020005'),/* Perawat */ 
        (9, '0002123045009', '3574011402000004'),/* Perawat */ 
        (10, '0002123045010', '3574012303020005'),/* Perawat */ 
        (11, '0002123045011', '3574012103020004'),/* Perawat */ 
        (12, '0002123045012', '3574011602010006'),/* Satpam */
        (13, '0002123045013', '3585200304020003'),/* Satpam */
        (14, '0002123045014', '3585010102010003'),/* Administrasi */
        (15, '0002123045015', '3585210405020003'),/* Administrasi */
        (16, '0002123045016', '3585220305030003'),/* Administrasi */
        (17, '0002123045017', '3585230404030003'),/* Apoteker */
        (18, '0002123045018', '3585240405020003'),/* Apoteker */
        (19, '0002123045019', '3585250202030003'),/* OB */
        (20, '0002123045020', '3585251203030003'),/* OB */
        (21, '0002123045021', '3585260104030003');/* Kasir */
        
INSERT INTO DOKTER
VALUES 	(1, 'Umum', '06.00-09.30'),
		(2, 'Umum', '06.00-09.30'),
        (3, 'Umum', '09.30-13.00'),
        (4, 'Umum', '09.30-13.00'),
        (5, 'Gigi', '06.00-13.00'),
        (6, 'Gigi', '06.00-09.30'),
        (7, 'Gigi', '09.30-13.00');

INSERT INTO PERAWAT
VALUES	(8, '06.30-09.30'),
		(9, '06.30-09.30'),
        (10, '09.30-13.00'),
        (11, '09.30-13.00');

INSERT INTO SATPAM
VALUES	(12, 1, 'N.80PAM00.003.2'),
		(13, 1, 'N.80PAM00.003.2');

INSERT INTO STAFF_ADMINISTRASI
VALUES	(14, '12345678910111213'),
		(15, '12345678910222225'),
        (16, '12345678910222213');
        
INSERT INTO APOTEKER
VALUES	(17, '001465/SKPA-P2/LSK-INTAKINDO/IX/2020'),
		(18, '001490/SKPA-P2/LSK-INTAKINDO/IX/2020');

INSERT INTO OB /* BELUM*/
VALUES	(19, 1, 'Kebersihan'),
		(20, 10, 'Kebersihan');
        
INSERT INTO KASIR 
VALUES 	(21, 'Akuntansi');
        
INSERT INTO POLI
VALUES  (1,'Poli Umum'),
		(2,'Poli Gigi');
        
INSERT INTO OBAT
VALUES  (1,'Paracetamol', '2025-04-04'),
		(2,'Amoxylin', '2025-04-04'),
        (3,'Paramex', '2025-04-04'),
        (4,'Ultraflu', '2025-04-04'),
        (5,'Antimo', '2025-04-04'),
        (6,'Brodex', '2025-04-04'),
        (7,'Antalgin', '2025-04-04');
        
INSERT INTO PASIEN
VALUES	(1,'215402030003','3585261402030003', 1, 8, 14, 21, 1, 1),
		(2,'215203030003','3586271203030003', 1, 8, 14, 21, 1, 1), 
        (3,'215606020003','3589271606020003', 1, 8, 14, 21, 1, 1),
        (4,'215301020003','3589281301020003', 2, 8, 15, 21, 1, 3),
        (5,'215502020003','3589291502020003', 2, 9, 15, 21, 1, 3),
        (6,'215502010003','3589381502020003', 3, 9, 15, 21, 1, 4),
        (7,'215309020003','3592381409020003', 4, 10, 16, 21, 2, 2),
        (8,'215010020003','3592382010020003', 5, 10, 16, 21, 2, 2),
        (9,'215210020003','3592481210020003', 5, 11, 16, 21, 2, 2),
        (10,'215511020003','3592621511020003', 6, 11, 16, 21, 2, 2);
        
SELECT * FROM PASIEN;
        
INSERT INTO RUANGAN
VALUES	(1, 'Ruang Tunggu', 'A1.1'),
		(2, 'Ruang Pemeriksaan Poli Umum 1', 'A1.2'),
        (3, 'Ruang Pemeriksaan Poli Umum 2', 'A1.3'),
        (4, 'Ruang Pemeriksaan Poli Gigi 1', 'A1.4'),
        (5, 'Ruang Pemeriksaan Poli Gigi 2', 'A1.5'),
        (6, 'Laboratorium Hematologi', 'A1.6'),
        (7, 'Laboratorium Patologi', 'A1.7'),
        (8, 'Ruang Obat', 'A1.8'),
        (9, 'Ruang Administrasi', 'A1.9'),
        (10, 'Mushola', 'A1.10');
 
SELECT ALAMAT, COUNT(*) AS JUMLAH_DATA
FROM MANUSIA
GROUP BY ALAMAT;
 
CREATE VIEW DAFTAR_PEKERJA AS
SELECT NAMA, M.KTP, NIP, JENIS_KELAMIN, TANGGAL_LAHIR, TIMESTAMPDIFF(YEAR, TANGGAL_LAHIR, CURDATE()) AS UMUR, ALAMAT
FROM MANUSIA M, PEKERJA P
WHERE M.KTP=P.KTP; 

SELECT * FROM DAFTAR_PEKERJA;

CREATE VIEW DAFTAR_DOKTER AS
SELECT NAMA, NIP, SPESIALIS, JAM_PRAKTIK
FROM MANUSIA M, PEKERJA P, DOKTER D
WHERE M.KTP=P.KTP AND P.ID_PEKERJA=D.ID_PEKERJA;

SELECT * FROM DAFTAR_DOKTER;

CREATE VIEW DAFTAR_PERAWAT AS
SELECT NAMA, NIP, JAM_JAGA
FROM MANUSIA M, PEKERJA PK, PERAWAT PR
WHERE M.KTP=PK.KTP AND PK.ID_PEKERJA=PR.ID_PEKERJA;

SELECT * FROM DAFTAR_PERAWAT;

CREATE VIEW DAFTAR_APOTEKER AS
SELECT NAMA, NIP, SKPA
FROM MANUSIA M, PEKERJA P, APOTEKER A
WHERE M.KTP=P.KTP AND P.ID_PEKERJA=A.ID_PEKERJA;

SELECT * FROM DAFTAR_APOTEKER;

CREATE VIEW DAFTAR_KASIR AS
SELECT NAMA, NIP, SKILL_FINANCIAL
FROM MANUSIA M, PEKERJA P, KASIR K
WHERE M.KTP=P.KTP AND P.ID_PEKERJA=K.ID_PEKERJA;

SELECT * FROM DAFTAR_KASIR;

CREATE VIEW DAFTAR_OB AS
SELECT M.NAMA, NIP, POSISI
FROM MANUSIA M, PEKERJA P, OB O
WHERE M.KTP=P.KTP AND P.ID_PEKERJA=O.ID_PEKERJA;

SELECT * FROM DAFTAR_OB;

CREATE VIEW DAFTAR_SATPAM AS
SELECT M.NAMA, NIP, KOMPETENSI_SECURITY
FROM MANUSIA M, PEKERJA P, SATPAM S
WHERE M.KTP=P.KTP AND P.ID_PEKERJA=S.ID_PEKERJA;
SELECT * FROM DAFTAR_SATPAM;

CREATE VIEW DAFTAR_STAFF_ADMINISTRASI AS
SELECT M.NAMA, NIP, STR
FROM MANUSIA M, PEKERJA P, STAFF_ADMINISTRASI S, RUANGAN R 
WHERE M.KTP=P.KTP AND P.ID_PEKERJA=S.ID_PEKERJA;

SELECT * FROM DAFTAR_STAFF_ADMINISTRASI;

CREATE VIEW DAFTAR_PASIEN AS
SELECT M.NAMA, M.KTP, BPJS, PO.NAMA AS POLI
FROM MANUSIA M, PASIEN PA, POLI PO
WHERE M.KTP=PA.KTP AND PA.ID_POLI=PO.ID_POLI;

SELECT * FROM DAFTAR_PASIEN;

SELECT NAMA, ALAMAT
FROM MANUSIA WHERE ALAMAT ='MADIUN' OR ALAMAT = 'MALANG' 
UNION SELECT NAMA, ALAMAT FROM MANUSIA
WHERE NAMA LIKE 'DR%' 
ORDER BY ALAMAT;

SELECT NAMA
FROM MANUSIA
WHERE KTP IN(SELECT KTP FROM PEKERJA WHERE ID_PEKERJA IN (SELECT ID_PEKERJA FROM DOKTER WHERE SPESIALIS = 'Gigi'));

SELECT NAMA
FROM MANUSIA
WHERE KTP IN(SELECT KTP FROM PEKERJA WHERE ID_PEKERJA IN (SELECT ID_PEKERJA FROM DOKTER WHERE SPESIALIS = 'Umum'));


SELECT NAMA, 
CASE JENIS_KELAMIN
WHEN 'L' THEN 'LAKI-LAKI'
WHEN 'P' THEN 'PEREMPUAN' END AS 'JENIS_KELAMIN'
FROM MANUSIA;
